<title>ç»¼åˆæ¼”ç¤º - æ•°æ®è¡¨æ ¼</title>

<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb">
        <a lay-href="">ä¸»é¡µ</a>
        <a><cite>ç»„ä»¶</cite></a>
        <a><cite>æ•°æ®è¡¨æ ¼</cite></a>
        <a><cite>ç»¼åˆæ¼”ç¤º</cite></a>
    </div>
</div>

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">ç»¼åˆæ¼”ç¤º</div>
                <div class="layui-card-body">
                    <table class="layui-hide" id="test-table-index" lay-filter="test-table-index"></table>

                    <script type="text/html" id="toolbarDemo">
                        <div class="layui-btn-container">
                            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">è·å–é€‰ä¸­è¡Œæ•°æ®</button>
                            <button class="layui-btn layui-btn-sm" lay-event="getData">è·å–å½“å‰é¡µæ•°æ®</button>
                            <button class="layui-btn layui-btn-sm" lay-event="isAll">æ˜¯å¦å…¨é€‰</button>
                            <button class="layui-btn layui-btn-sm layui-bg-blue" id="reloadTest">
                                é‡è½½æµ‹è¯•
                                <i class="layui-icon layui-icon-down layui-font-12"></i>
                            </button>
                            <button class="layui-btn layui-btn-sm layui-btn-primary" lay-event="multi-row">
                                å¤šè¡Œ
                            </button>
                            <button class="layui-btn layui-btn-sm layui-btn-primary" lay-event="default-row">
                                å•è¡Œ
                            </button>
                            <button class="layui-btn layui-btn-sm" id="moreTest">
                                æ›´å¤šæµ‹è¯•
                                <i class="layui-icon layui-icon-down layui-font-12"></i>
                            </button>
                        </div>
                    </script>

                    <script type="text/html" id="cityTpl">
                        <select id="demoCity1" class="layui-border" lay-ignore>
                            <option value="æµ™æ±Ÿæ­å·">æµ™æ±Ÿæ­å·</option>
                            <option value="æ±Ÿè¥¿å—æ˜Œ">æ±Ÿè¥¿å—æ˜Œ</option>
                            <option value="æ¹–åŒ—æ­¦æ±‰">æ¹–åŒ—æ­¦æ±‰</option>
                        </select>
                    </script>

                    <script type="text/html" id="barDemo">
                        <a class="layui-btn layui-btn-xs" lay-event="edit">ç¼–è¾‘</a>
                        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  layui.use(['admin', 'table', 'dropdown'], function () {
    var table = layui.table
    var dropdown = layui.dropdown

    // åˆ›å»ºæ¸²æŸ“å®ä¾‹
    table.render({
      elem: '#test-table-index'
      , url: layui.setter.paths.base + 'json/table/demo.js' // æ­¤å¤„ä¸ºé™æ€æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€æ¢æˆçœŸå®æ¥å£
      , toolbar: '#toolbarDemo'
      , defaultToolbar: ['filter', 'exports', 'print', {
        title: 'å¸®åŠ©'
        , layEvent: 'LAYTABLE_TIPS'
        , icon: 'layui-icon-tips'
      }]
      , height: 'full-200' // æœ€å¤§é«˜åº¦å‡å»å…¶ä»–å®¹å™¨å·²å æœ‰çš„é«˜åº¦å·®
      , cellMinWidth: 80
      , totalRow: true // å¼€å¯åˆè®¡è¡Œ
      , page: true
      , cols: [[
        { type: 'checkbox', fixed: 'left' }
        , { field: 'id', fixed: 'left', width: 80, title: 'ID', sort: true, totalRowText: 'åˆè®¡ï¼š' }
        , { field: 'username', width: 80, title: 'ç”¨æˆ·' }
        , {
          field: 'email',
          title: 'é‚®ç®± <i class="layui-icon layui-icon-email"></i>',
          hide: 0,
          width: 150,
          edit: 'text'
        }
        , { field: 'sex', width: 80, title: 'æ€§åˆ«', sort: true }
        , {
          field: 'city',
          width: 115,
          title: 'åŸå¸‚',
          minWidth: 115,
          templet: '#cityTpl',
          exportTemplet: function (d, obj) {
            //console.log(obj)
            // å¤„ç†è¯¥å­—æ®µçš„å¯¼å‡ºæ•°æ®
            var td = obj.td(this.field) //è·å–å½“å‰ td
            return td.find('select').val()
          }
        }
        , { field: 'sign', title: 'ç­¾å', edit: 'textarea', minWidth: 260, style: '-moz-box-align: start;' }
        , { field: 'experience', width: 100, title: 'ç§¯åˆ†', sort: true, totalRow: '{{= d.TOTAL_NUMS }} ğŸ˜Š' }
        , {
          field: 'checkin',
          title: 'æ‰“å¡',
          width: 100,
          sort: true,
          totalRow: '{{= parseInt(d.TOTAL_NUMS) }} æ¬¡'
        }
        , { field: 'ip', title: 'IP', width: 120 }
        , { field: 'joinTime', title: 'åŠ å…¥æ—¶é—´', width: 120 }
        , { fixed: 'right', title: 'æ“ä½œ', width: 125, minWidth: 125, toolbar: '#barDemo' }
      ]]
      , done: function () {
        var id = this.id

        // é‡è½½æµ‹è¯•
        dropdown.render({
          elem: '#reloadTest' //å¯ç»‘å®šåœ¨ä»»æ„å…ƒç´ ä¸­ï¼Œæ­¤å¤„ä»¥ä¸Šè¿°æŒ‰é’®ä¸ºä¾‹
          , data: [{
            id: 'reload',
            title: 'é‡è½½'
          }, {
            id: 'reload-deep',
            title: 'é‡è½½ - å‚æ•°å åŠ '
          }, {
            id: 'reloadData',
            title: 'ä»…é‡è½½æ•°æ®'
          }, {
            id: 'reloadData-deep',
            title: 'ä»…é‡è½½æ•°æ® - å‚æ•°å åŠ '
          }]
          // èœå•è¢«ç‚¹å‡»çš„äº‹ä»¶
          , click: function (obj) {
            switch (obj.id) {
              case 'reload':
                // é‡è½½ - é»˜è®¤ï¼ˆå‚æ•°é‡ç½®ï¼‰
                table.reload('test-table-index', {
                  where: {
                    abc: '123456'
                    //,test: 'æ–°çš„ test2'
                    //,token: 'æ–°çš„ token2'
                  }
                  /*
                  ,cols: [[ // é‡ç½®è¡¨å¤´
                    {type: 'checkbox', fixed: 'left'}
                    ,{field:'id', title:'ID', width:80, fixed: 'left', unresize: true, sort: true, totalRowText: 'åˆè®¡ï¼š'}
                    ,{field:'sex', title:'æ€§åˆ«', width:80, edit: 'text', sort: true}
                    ,{field:'experience', title:'ç§¯åˆ†', width:80, sort: true, totalRow: true, templet: '<div>{{ d.experience }} åˆ†</div>'}
                    ,{field:'logins', title:'ç™»å…¥æ¬¡æ•°', width:100, sort: true, totalRow: true}
                    ,{field:'joinTime', title:'åŠ å…¥æ—¶é—´', width:120}
                  ]]
                  */
                })
                break
              case 'reload-deep':
                // é‡è½½ - æ·±åº¦ï¼ˆå‚æ•°å åŠ ï¼‰
                table.reload('test-table-index', {
                  where: {
                    abc: 123
                    , test: 'æ–°çš„ test1'
                  }
                  //,defaultToolbar: ['print'] // é‡è½½å¤´éƒ¨å·¥å…·æ å³ä¾§å›¾æ ‡
                  //,cols: ins1.config.cols
                }, true)
                break
              case 'reloadData':
                // æ•°æ®é‡è½½ - å‚æ•°é‡ç½®
                table.reloadData('test-table-index', {
                  where: {
                    abc: '123456'
                    //,test: 'æ–°çš„ test2'
                    //,token: 'æ–°çš„ token2'
                  }
                  , scrollPos: 'fixed'  // ä¿æŒæ»šåŠ¨æ¡ä½ç½®ä¸å˜ - v2.7.3 æ–°å¢
                  , height: 2000 // æµ‹è¯•æ— æ•ˆå‚æ•°ï¼ˆå³ä¸æ•°æ®æ— å…³çš„å‚æ•°è®¾ç½®æ— æ•ˆï¼Œæ­¤å¤„ä»¥ height è®¾ç½®æ— æ•ˆä¸ºä¾‹ï¼‰
                  //,url: '404'
                  //,page: {curr: 1, limit: 30} // é‡æ–°æŒ‡å‘åˆ†é¡µ
                })
                break
              case 'reloadData-deep':
                // æ•°æ®é‡è½½ - å‚æ•°å åŠ 
                table.reloadData('test-table-index', {
                  where: {
                    abc: 123
                    , test: 'æ–°çš„ test1'
                  }
                }, true)
                break
            }
            layer.msg('å¯è§‚å¯Ÿ Network è¯·æ±‚å‚æ•°çš„å˜åŒ–')
          }
        })

        // æ›´å¤šæµ‹è¯•
        dropdown.render({
          elem: '#moreTest' //å¯ç»‘å®šåœ¨ä»»æ„å…ƒç´ ä¸­ï¼Œæ­¤å¤„ä»¥ä¸Šè¿°æŒ‰é’®ä¸ºä¾‹
          , data: [{
            id: 'add',
            title: 'æ·»åŠ '
          }, {
            id: 'update',
            title: 'ç¼–è¾‘'
          }, {
            id: 'delete',
            title: 'åˆ é™¤'
          }]
          //èœå•è¢«ç‚¹å‡»çš„äº‹ä»¶
          , click: function (obj) {
            var checkStatus = table.checkStatus(id)
            var data = checkStatus.data // è·å–é€‰ä¸­çš„æ•°æ®
            switch (obj.id) {
              case 'add':
                layer.open({
                  title: 'æ·»åŠ ',
                  type: 1,
                  area: ['80%', '80%'],
                  content: '<div style="padding: 16px;">è‡ªå®šä¹‰è¡¨å•å…ƒç´ </div>'
                })
                break
              case 'update':
                if (data.length !== 1) return layer.msg('è¯·é€‰æ‹©ä¸€è¡Œ')
                layer.open({
                  title: 'ç¼–è¾‘',
                  type: 1,
                  area: ['80%', '80%'],
                  content: '<div style="padding: 16px;">è‡ªå®šä¹‰è¡¨å•å…ƒç´ </div>'
                })
                break
              case 'delete':
                if (data.length === 0) {
                  return layer.msg('è¯·é€‰æ‹©ä¸€è¡Œ')
                }
                layer.msg('delete event')
                break
            }
          }
        })
      }
      , error: function (res, msg) {
        console.log(res, msg)
      }
    })

    // å·¥å…·æ äº‹ä»¶
    table.on('toolbar(test-table-index)', function (obj) {
      var id = obj.config.id
      var checkStatus = table.checkStatus(id)
      var othis = lay(this)
      switch (obj.event) {
        case 'getCheckData':
          var data = checkStatus.data
          layer.alert(layui.util.escape(JSON.stringify(data)))
          break
        case 'getData':
          var getData = table.getData(id)
          console.log(getData)
          layer.alert(layui.util.escape(JSON.stringify(getData)))
          break
        case 'isAll':
          layer.msg(checkStatus.isAll ? 'å…¨é€‰' : 'æœªå…¨é€‰')
          break
        case 'multi-row':
          table.reload('test-table-index', {
            // è®¾ç½®è¡Œæ ·å¼ï¼Œæ­¤å¤„ä»¥è®¾ç½®å¤šè¡Œé«˜åº¦ä¸ºä¾‹ã€‚è‹¥ä¸ºå•è¡Œï¼Œåˆ™æ²¡å¿…è¦è®¾ç½®æ”¹å‚æ•° - æ³¨ï¼šv2.7.0 æ–°å¢
            lineStyle: 'height: 95px;'
          })
          layer.msg('å³é€šè¿‡è®¾ç½® lineStyle å‚æ•°å¯å¼€å¯å¤šè¡Œ')
          break
        case 'default-row':
          table.reload('test-table-index', {
            lineStyle: null // æ¢å¤å•è¡Œ
          })
          layer.msg('å·²è®¾ä¸ºå•è¡Œ')
          break
        case 'LAYTABLE_TIPS':
          layer.alert('Table for layui-v' + layui.v)
          break
      }

    })

    //è§¦å‘å•å…ƒæ ¼å·¥å…·äº‹ä»¶
    table.on('tool(test-table-index)', function (obj) { // åŒå‡» toolDouble
      var data = obj.data
      //console.log(obj)
      if (obj.event === 'del') {
        layer.confirm('çœŸçš„åˆ é™¤è¡Œä¹ˆ', function (index) {
          obj.del()
          layer.close(index)
        })
      } else if (obj.event === 'edit') {
        layer.open({
          title: 'ç¼–è¾‘',
          type: 1,
          area: ['80%', '80%'],
          content: '<div style="padding: 16px;">è‡ªå®šä¹‰è¡¨å•å…ƒç´ </div>'
        })
      }
    })

    //è§¦å‘è¡¨æ ¼å¤é€‰æ¡†é€‰æ‹©
    table.on('checkbox(test-table-index)', function (obj) {
      console.log(obj)
    })

    //è§¦å‘è¡¨æ ¼å•é€‰æ¡†é€‰æ‹©
    table.on('radio(test-table-index)', function (obj) {
      console.log(obj)
    })

    // è¡Œå•å‡»äº‹ä»¶
    table.on('row(test-table-index)', function (obj) {
      //console.log(obj);
      //layer.closeAll('tips');
    })
    // è¡ŒåŒå‡»äº‹ä»¶
    table.on('rowDouble(test-table-index)', function (obj) {
      console.log(obj)
    })

    // å•å…ƒæ ¼ç¼–è¾‘äº‹ä»¶
    table.on('edit(test-table-index)', function (obj) {
      var field = obj.field //å¾—åˆ°å­—æ®µ
        , value = obj.value //å¾—åˆ°ä¿®æ”¹åçš„å€¼
        , data = obj.data //å¾—åˆ°æ‰€åœ¨è¡Œæ‰€æœ‰é”®å€¼

      var update = {}
      update[field] = value
      obj.update(update)
    })
  })
</script>